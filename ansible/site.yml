---

# # =========================================================
# #       PLAY -- Read in global variables
# # ---------------------------------------------------------

- name: Include deployment information
  hosts: all
  gather_facts: True
  vars:
    - name: "{{ tags.Name }}"
    - instance_id: "{{ instance_id }}"
    - region: "{{ placement.region }}"
    - zone: "{{ placement.availability_zone }}"
    - instance_type: "{{  instance_type }}"
    - public_ip: "{{ public_ip_address }}"
    - private_ip: "{{ private_ip_address }}"
    - tags: "{{ tags }}"
  
# =========================================================
#       PLAY -- Configure database tier
# ---------------------------------------------------------

- name: Configure instances in database tier
  hosts: all
  remote_user: ec2-user
  become: yes
  become_method: sudo
  gather_facts: True

  pre_tasks:
  - name: Pause for all instances to be ready for configuration
    wait_for_connection:
      sleep: 5
      timeout: 300
    
  roles:
  - siwapp_db
